
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP32 Health Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
h1 { text-align: center; }
#chart-container { width: 100%; max-width: 900px; margin: auto; }
.latest { text-align: center; margin-top: 20px; font-size: 18px; }
</style>
</head>
<body>
<h1>ESP32 Health Dashboard</h1>
<div id="chart-container">
<canvas id="healthChart"></canvas>
</div>
<div class="latest" id="latestValues">Loading latest data...</div>


<script>
const ctx = document.getElementById('healthChart').getContext('2d');
const healthChart = new Chart(ctx, {
type: 'line',
data: {
labels: [],
datasets: [
{ label: 'Heart Rate', data: [], borderColor: '#8884d8', fill: false },
{ label: 'SpO2', data: [], borderColor: '#82ca9d', fill: false }
]
},
options: { responsive: true, animation: false, scales: { x: { type: 'time', time: { parser: 'ISO', unit: 'second', displayFormats: { second: 'HH:mm:ss' } } }, y: { beginAtZero: true } } }
});


async function fetchData() {
try {
const res = await fetch('/api/sensor?ts=' + Date.now(), { cache: 'no-store' });
const data = await res.json();
const last50 = data.slice(-50);
healthChart.data.labels = last50.map(d => new Date(d.time));
healthChart.data.datasets[0].data = last50.map(d => d.heartrate);
healthChart.data.datasets[1].data = last50.map(d => d.spo2);
healthChart.update();


if(last50.length > 0){
document.getElementById('latestValues').innerText = `Latest: Heart Rate: ${last50[last50.length-1].heartrate}, SpO2: ${last50[last50.length-1].spo2}`;
}
} catch(err) {
console.error('Error fetching data:', err);
}
}


fetchData();
setInterval(fetchData, 2000);
</script>
</body>
</html>
