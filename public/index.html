<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ESP32 Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  canvas { max-width: 600px; margin-top: 20px; }
</style>
</head>
<body>
<h1>ESP32 Dashboard</h1>
<canvas id="spo2Chart"></canvas>
<canvas id="hrChart"></canvas>

<script>
async function fetchData() {
  try {
    const res = await fetch("/api/get");
    const data = await res.json();

    const spo2Data = data.map(d => d.spo2);
    const hrData = data.map(d => d.heartrate);
    const labels = data.map(d => new Date(d.ts).toLocaleTimeString());

    setChart(spo2Chart, labels, spo2Data, "SpO2", "rgba(255,0,0,0.6)");
    setChart(hrChart, labels, hrData, "Heart Rate", "rgba(0,0,255,0.6)");
  } catch (err) {
    console.error("Error fetching data:", err);
  }
}

function setChart(chartInstance, labels, data, label, color) {
  if (chartInstance.chart) {
    chartInstance.chart.data.labels = labels;
    chartInstance.chart.data.datasets[0].data = data;
    chartInstance.chart.update();
  } else {
    chartInstance.chart = new Chart(chartInstance, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: label,
          data: data,
          borderColor: color,
          fill: false,
        }]
      },
      options: { responsive: true }
    });
  }
}

const spo2Chart = document.getElementById("spo2Chart");
const hrChart = document.getElementById("hrChart");

setInterval(fetchData, 1000); // تحديث كل ثانية
fetchData(); // تحميل أولي
</script>
</body>
</html>

