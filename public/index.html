<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ESP32 Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<h1>ESP32 Health Dashboard</h1>
<canvas id="chart" width="800" height="400"></canvas>

<script>
const ctx = document.getElementById('chart').getContext('2d');
const chart = new Chart(ctx, {
  type: 'line',
  data: { labels: [], datasets: [
    { label: 'Heart Rate', borderColor: 'blue', data: [] },
    { label: 'SpO2', borderColor: 'green', data: [] }
  ]},
  options: { scales: { x: { type: 'time', time: { unit: 'second' } } } }
});

async function fetchData() {
  try {
    const res = await fetch('/api/sensor?ts=' + Date.now());
    const data = await res.json();
    chart.data.labels = data.map(d => new Date(d.time));
    chart.data.datasets[0].data = data.map(d => d.heartrate);
    chart.data.datasets[1].data = data.map(d => d.spo2);
    chart.update();
  } catch (e) {
    console.error("Error fetching data:", e);
  }
}

setInterval(fetchData, 2000);
fetchData();
</script>
</body>
</html>
